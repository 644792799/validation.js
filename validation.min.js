/**
 * @author Matt Hinchliffe <http://www.maketea.co.uk>
 * @version 0.9.4
 * @modified 21/02/2011
 */

var Validation={init:function(form_id,model,opts){this.options={error_node:opts.error_node||'p',error_class:opts.error_class||'form_error',error_display:opts.error_display!==false,error_message:opts.error_message||'The given value is invalid.',error_placement:opts.error_placement||'after'};if(!(this.form=document.getElementById(form_id))||typeof model!=='object'){return null;}this.model=model;var self=this;this.bind(function(event){self.form_valid=true;self.errors=self.valid={};for(var input in self.model){var target;if(!(target=document.getElementById(input))){break;}var value=self.get_value(target);self.clear_error_message(input);for(var method in self.model[input]){var error,is_array,arguments=self.model[input][method];if(method!='error'){if(typeof self[method]!=='function'){break;}if(Array.isArray){is_array=Array.isArray(arguments);}else
{is_array=(Object.prototype.toString.call(arguments)==='[object Array]');}if(is_array){error=arguments[arguments.length-1]||self.options.error_message;}else
{error=self.model[input]['error']||self.options.error_message;arguments=[arguments];}if(self[method].apply(self,[value].concat(arguments))===false){self.form_valid=self.valid[input]=false;self.create_error_message(target,error);break;}}}}event.returnValue=self.form_valid;if(!self.form_valid&&event.preventDefault){event.preventDefault();}});},bind:function(handler){if(this.form.addEventListener){this.form.addEventListener('submit',handler,false);}else
{this.form.attachEvent('onsubmit',handler);}},get_value:function(obj){var type;if(obj.nodeName.toLowerCase()=='input'){type=obj.getAttribute('type');}if(type&&(type=='checkbox'||type=='radio')){return obj.checked?true:false;}else
{return obj.value!==undefined?obj.value:false;}},create_error_message:function(target,message){this.errors[target.id]=message;if(!message||!this.options.error_display){return;}var msg=document.createElement(this.options.error_node);msg.setAttribute('class',this.options.error_class);msg.setAttribute('id','error__'+target.id);var txt=document.createTextNode(message);msg.appendChild(txt);var parent=target.parentNode;if(this.options.error_placement=='before'){var before=parent.firstChild;parent.insertBefore(msg,before);}else
{parent.appendChild(msg);}},clear_error_message:function(id){var error=document.getElementById('error__'+id);if(error){error.parentNode.removeChild(error);}},present:function(value,not){var bool;if(typeof value=='boolean'){bool=value;}else if(!value){bool=false;}else
{bool=!!(value.length>0);}return(not)?bool:!bool;},expressions:{alphanumeric:/^([a-z0-9_\-])$/,number:/^([0-9])+$/,text:/^(^[a-z])+$/,email:/^([a-z0-9_\.\-]+)@([\da-z\.\-]+)\.([a-z\.]{2,6})$/,url:/^(https?:\/\/)?([\da-z\.\-]+)\.([a-z\.]{2,6})([\/\w \.\-]*)*\/?$/,date:/^(([0-3])?[0-9]\-([0-1])?[0-9]\-([0-9][0-9])?[0-9][0-9])$/,time:/^(([0-2])?[0-9]:[0-5][0-9])$/},test:function(value,regex){if(this.expressions[regex]){return!!(this.expressions[regex]).test(value.toString());}else
{return false;}},minimum_length:function(value,required){if(!this.present(value)){return null;}return!!(value.length>=required);},maximum_length:function(value,required){if(!this.present(value)){return null;}return!!(value.length<=required);},greater_than:function(value,required){if(!this.present(value)){return null;}return!!(parseInt(value,10)>=required);},less_than:function(value,required){if(!this.present(value)){return null;}return!!(parseInt(value,10)<=required);},match:function(value,target_id){var target=document.getElementById(target_id),match=target?this.get_value(target):null;return!!(value===match);}};function Validate(form_id,model,opts){opts=opts||{};var validation=Object.create(Validation);validation.init(form_id,model,opts);return validation;}if(typeof Object.create!=='function'){Object.create=function(o){function F(){}F.prototype=o;return new F();};}